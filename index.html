<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login - Program Piket OSIS (ES Module)</title>

  <style>
    /* =========== GAYA CSS (SAMA DENGAN VERSI AWAL) =========== */
    :root {
        --primary-blue: #007bff;
        --secondary-yellow: #ffc107;
        --light-bg: #f8f9fa;
        --white: #ffffff;
        --dark-text: #333;
        --blue-text: #0056b3;
        --border-color: #dee2e6;
        --danger-red: #dc3545;
        --warning-orange: #fd7e14;
        --success-green: #28a745;
        --info-cyan: #17a2b8;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--light-bg);
        color: var(--dark-text);
        line-height: 1.6;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    #login-screen {
        width: 100%;
        max-width: 400px;
        padding: 40px;
        background-color: var(--white);
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-top: 5px solid var(--primary-blue);
        text-align: center;
    }
    #login-screen h2 {
        color: var(--primary-blue);
        margin-bottom: 25px;
        border-bottom: 2px solid var(--secondary-yellow);
        padding-bottom: 10px;
    }
    #login-screen label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: var(--blue-text);
        text-align: left;
    }
    #login-screen input[type="text"],
    #login-screen input[type="password"] {
        width: calc(100% - 22px);
        padding: 12px;
        margin-bottom: 20px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 1rem;
    }
    #login-screen button {
        background-color: var(--primary-blue);
        color: var(--white);
        border: none;
        padding: 12px 25px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1.1rem;
        transition: background-color 0.3s ease;
        width: 100%;
    }
    #login-screen button:hover {
        background-color: var(--blue-text);
    }
    #login-error {
        color: var(--danger-red);
        margin-top: 15px;
        font-weight: bold;
        min-height: 1.2em;
    }

    #main-app {
        width: 100%;
        max-width: 900px;
        margin: 20px auto;
        background-color: var(--white);
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border-top: 5px solid var(--primary-blue);
        display: none;
    }
    #main-app h1, #main-app h2, #main-app h3 {
        color: var(--primary-blue);
    }
    #main-app h1 {
        border-bottom: 2px solid var(--secondary-yellow);
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    #main-app h2 {
        border-bottom: 1px solid var(--secondary-yellow);
        padding-bottom: 8px;
        margin-bottom: 15px;
        margin-top: 30px;
    }
    #main-app h3 {
        margin-top: 20px;
        margin-bottom: 10px;
        color: var(--blue-text);
        font-size: 1.1em;
    }
    .section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        background-color: #fdfdff;
    }
    #main-app label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: var(--blue-text);
    }
    #main-app input[type="text"],
    #main-app input[type="date"],
    #main-app select,
    #main-app textarea {
        width: calc(100% - 22px);
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 1rem;
    }
    #main-app textarea {
        min-height: 80px;
    }
    #main-app button {
        background-color: var(--primary-blue);
        color: var(--white);
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease;
        margin-right: 10px;
        margin-bottom: 10px;
    }
    #main-app button:hover {
        background-color: var(--blue-text);
    }
    #main-app button.secondary {
        background-color: var(--secondary-yellow);
        color: var(--dark-text);
    }
    #main-app button.secondary:hover {
        background-color: #e0a800;
    }
    #main-app button.danger {
        background-color: var(--danger-red);
    }
    #main-app button.danger:hover {
        background-color: #c82333;
    }
    #main-app button.warning {
        background-color: var(--warning-orange);
    }
    #main-app button.warning:hover {
        background-color: #e46d0f;
    }
    #main-app button.info {
        background-color: var(--info-cyan);
    }
    #main-app button.info:hover {
        background-color: #138496;
    }
    #main-app button.small-btn {
        padding: 5px 10px;
        font-size: 0.9em;
        margin-left: 5px;
    }
    #main-app ul,
    #memberListDisplay li,
    #scheduleDisplay div,
    #attendanceMarking div,
    #reportDisplay div {
        list-style: none;
        padding: 0;
    }
    #memberListDisplay li,
    #scheduleDisplay div,
    #attendanceMarking div,
    .report-item {
        background-color: var(--light-bg);
        padding: 10px 15px;
        margin-bottom: 8px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    #memberListDisplay li span.member-name {
        flex-grow: 1;
        margin-right: 10px;
    }
    #memberListDisplay li .edit-controls input[type="text"] {
        width: auto;
        flex-grow: 1;
        margin-right: 5px;
    }
    .edit-controls {
        display: none;
        align-items: center;
        width: 100%;
    }
    #scheduleDisplay strong,
    #attendanceStatus strong {
        color: var(--primary-blue);
        min-width: 80px;
        display: inline-block;
    }
    #attendanceCheckboxes .attendance-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        padding: 5px;
        border-radius: 4px;
        transition: background-color 0.2s;
    }
    #attendanceCheckboxes .attendance-item:hover {
        background-color: #e9ecef;
    }
    #attendanceCheckboxes label {
        display: inline-flex;
        align-items: center;
        margin-left: 0;
        margin-right: 15px;
        font-weight: normal;
        color: var(--dark-text);
        cursor: pointer;
        flex-grow: 1;
    }
    #attendanceCheckboxes input[type="checkbox"] {
        margin-right: 8px;
        transform: scale(1.2);
        cursor: pointer;
    }
    #attendanceCheckboxes input[type="text"].reason-input {
        display: none;
        margin-left: 10px;
        padding: 4px 8px;
        font-size: 0.9em;
        border: 1px solid var(--border-color);
        border-radius: 3px;
        width: auto;
        flex-basis: 200px;
    }
    #attendanceStatus {
        margin-top: 20px;
        padding: 15px;
        border: 1px dashed var(--primary-blue);
        border-radius: 5px;
    }
    #attendanceStatus ul {
        margin-top: 10px;
    }
    #attendanceStatus li {
        margin-bottom: 5px;
        padding-left: 15px;
    }
    #attendanceStatus .present {
        color: var(--success-green);
        font-weight: bold;
    }
    #attendanceStatus .absent {
        color: var(--danger-red);
        font-weight: bold;
    }
    #attendanceStatus .reason-text {
        font-size: 0.9em;
        color: #555;
        margin-left: 5px;
    }
    .report-bar-container {
        display: flex;
        align-items: center;
        margin-top: 5px;
    }
    .report-bar {
        height: 20px;
        background-color: var(--primary-blue);
        border-radius: 3px;
        margin-right: 10px;
        min-width: 10px;
        transition: width 0.5s ease-out;
    }
    .report-bar.low {
        background-color: var(--secondary-yellow);
    }
    .report-text {
        font-size: 0.9em;
        color: #555;
    }
    .report-summary {
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
        font-size: 1.05em;
    }
    small {
        color: #6c757d;
        display: block;
        margin-top: -10px;
        margin-bottom: 15px;
    }
    .hidden {
        display: none;
    }
    @media print {
        body {
            padding: 0;
            margin: 10mm;
            font-size: 10pt;
            background-color: var(--white) !important;
            color: #000 !important;
        }
        #login-screen,
        #main-app .section:not(#reportSection),
        #main-app button,
        #main-app input,
        #main-app select,
        #main-app textarea,
        #main-app small,
        #main-app h3:not(#reportSection h3),
        #main-app label,
        .edit-controls,
        .no-print {
            display: none !important;
        }
        #main-app {
            box-shadow: none;
            border: none;
            padding: 0;
            margin: 0;
        }
        #reportSection,
        #reportDisplay,
        .report-item,
        #main-app h1,
        #main-app #reportSection h2 {
            display: block !important;
            width: 100%;
            box-shadow: none;
            border: none;
            page-break-inside: avoid;
        }
        #main-app h1,
        #main-app #reportSection h2 {
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-bottom: 15px;
            color: #000 !important;
        }
        .report-item {
            border: 1px solid #eee;
            padding: 8px;
            margin-bottom: 5px;
            background-color: var(--white) !important;
        }
        .report-bar-container {
            display: none;
        }
        .report-text {
            display: inline;
            margin-left: 5px;
        }
        #attendanceStatus {
            border: 1px solid #ccc;
        }
        #attendanceStatus .present,
        #attendanceStatus .absent {
            font-weight: normal;
        }
        #attendanceStatus .reason-text {
            font-style: italic;
        }
        a[href]:after {
            content: none !important;
        }
    }
  </style>
</head>
<body>

  <!-- 1. LOGIN SCREEN -->
  <div id="login-screen">
    <h2>Login Admin Piket OSIS</h2>
    <form onsubmit="event.preventDefault(); handleLogin();">
      <div>
        <label for="username">Username:</label>
        <input type="text" id="username" required value="Admin" />
      </div>
      <div>
        <label for="password">Password:</label>
        <input type="password" id="password" required value="Admin123" />
      </div>
      <button type="submit">Login</button>
      <p id="login-error"></p>
    </form>
  </div>

  <!-- 2. MAIN APP -->
  <div id="main-app">
    <div class="container">
      <h1>📋 Program Piket OSIS (ES Module)</h1>

      <!-- 1. Input Anggota OSIS -->
      <div class="section">
        <h2>Anggota OSIS</h2>
        <label for="newMemberName">Nama Lengkap Anggota Baru:</label>
        <input type="text" id="newMemberName" placeholder="Masukkan nama lengkap..." />
        <button onclick="addMember()">Tambah Anggota</button>

        <h3>Daftar Anggota Saat Ini:</h3>
        <ul id="memberListDisplay"></ul>
      </div>

      <!-- 2. Input Jadwal Piket -->
      <div class="section">
        <h2>Jadwal Piket Mingguan</h2>
        <label for="scheduleDay">Pilih Hari:</label>
        <select id="scheduleDay">
          <option value="Senin">Senin</option>
          <option value="Selasa">Selasa</option>
          <option value="Rabu">Rabu</option>
          <option value="Kamis">Kamis</option>
          <option value="Jumat">Jumat</option>
          <option value="Sabtu">Sabtu</option>
          <option value="Minggu">Minggu</option>
        </select>

        <label>Pilih Anggota untuk Hari Ini:</label>
        <div id="memberCheckboxList" class="member-checkbox-list"></div>
        <button onclick="saveScheduleForDay()">Simpan Jadwal Hari Ini</button>
        <button class="secondary" onclick="clearScheduleForDay()">Kosongkan Jadwal Hari Ini</button>

        <h3>Jadwal Tersimpan:</h3>
        <div id="scheduleDisplay"></div>
      </div>

      <!-- 3. Input Kehadiran Piket -->
      <div class="section">
        <h2>Catat Kehadiran Piket</h2>
        <label for="attendanceDate">Pilih Tanggal Piket:</label>
        <input type="date" id="attendanceDate" />
        <button onclick="showAttendanceForm()">Pilih Tanggal & Tampilkan Form</button>

        <div id="attendanceMarking" style="display: none;">
          <h3>
            Tandai Kehadiran untuk <span id="selectedDateDisplay"></span> 
            (<span id="selectedDayDisplay"></span>):
          </h3>
          <p id="noScheduleMessage" style="display:none; color: orange;">
            Tidak ada jadwal piket untuk hari ini.
          </p>
          <div id="attendanceCheckboxes"></div>
          <button onclick="saveAttendance()" id="saveAttendanceButton" style="display:none;">
            Simpan Kehadiran
          </button>
          <div id="attendanceStatus"></div>
        </div>
      </div>

      <!-- 4. Laporan Kerajinan -->
      <div class="section" id="reportSection">
        <h2>Laporan Kerajinan</h2>
        <button onclick="generateReport()">Buat Laporan</button>
        <button onclick="exportReportToCSV()" class="info small-btn no-print">
          Ekspor Laporan ke CSV
        </button>
        <small>
          Laporan didasarkan pada data kehadiran yang sudah disimpan di Firestore.
        </small>
        <div id="reportDisplay"></div>
      </div>

      <!-- 5. Data Management Section (Firestore) -->
      <div class="section no-print">
        <h2>Manajemen Data</h2>
        <div>
          <h3>Backup Data (Firestore)</h3>
          <p>
            Data sudah disimpan ke Firestore, jadi *backup* di sini hanya menyalin data 
            (anggota, jadwal, kehadiran) yang terakhir dimuat ke memori.
          </p>
          <textarea
            id="backupDataArea"
            rows="5"
            readonly
            placeholder="Klik 'Backup Data' untuk menampilkan data di sini..."
          ></textarea>
          <button onclick="backupData()" class="info">Backup Data</button>
        </div>

        <div style="margin-top: 20px;">
          <h3>Restore Data Lokal ke Firestore</h3>
          <p>
            <strong>PERHATIAN:</strong> Ini akan menimpa data di Firestore 
            dengan data yang kamu paste di sini. Pastikan format JSON valid!
          </p>
          <textarea
            id="restoreDataArea"
            rows="5"
            placeholder="Tempel data backup (format JSON) di sini..."
          ></textarea>
          <button onclick="restoreData()" class="warning">Restore Data</button>
        </div>

        <div style="margin-top: 30px; border-top: 1px dashed var(--danger-red); padding-top: 20px;">
          <h3>Reset Aplikasi</h3>
          <p>
            <strong>PERHATIAN BESAR:</strong> Ini akan menghapus SEMUA data anggota, 
            jadwal, dan kehadiran di Firestore. Hati-hati ya!
          </p>
          <button onclick="resetAllData()" class="danger">Reset Semua Data Aplikasi</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Script ES Module (v9) di bawah agar DOM sudah siap -->
  <script type="module">
    /***********************************************************************
     *     1) IMPORT DARI FIREBASE (v9 MODULAR) VIA CDN/ES MODULE          *
     ***********************************************************************/
    import {
      initializeApp
    } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";

    import {
      getFirestore, collection, doc, getDocs, setDoc, addDoc, updateDoc, deleteDoc,
      writeBatch
    } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-firestore.js";

    /***********************************************************************
     *           2) KONFIGURASI DAN INISIALISASI FIREBASE                  *
     ***********************************************************************/
    // Ganti dengan konfigurasi Firebase-mu
    const firebaseConfig = {
      apiKey: "AIzaSyAsBHJoii6RBGrslUH31ix1AyLheRm6HS4",
      authDomain: "piketosis.firebaseapp.com",
      projectId: "piketosis",
      storageBucket: "piketosis.firebasestorage.app",
      messagingSenderId: "341698253309",
      appId: "1:341698253309:web:a5ea2d83768348a7f9c994",
    };

    // Inisialisasi
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app); // Inisialisasi Firestore

    /***********************************************************************
     *     3) VARIABEL GLOBAL DAN DOM REFERENCES                           *
     ***********************************************************************/
    const daysInIndonesian = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];

    let members = [];     // Array of string (nama anggota)
    let schedule = {};    // { Senin: [...], Selasa: [...], ... }
    let attendance = {};  // { "YYYY-MM-DD": { "MemberName": { present: bool, reason: "" } } }

    // DOM
    const loginScreen = document.getElementById('login-screen');
    const mainApp = document.getElementById('main-app');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginError = document.getElementById('login-error');

    const newMemberNameInput = document.getElementById('newMemberName');
    const memberListDisplay = document.getElementById('memberListDisplay');
    const scheduleDaySelect = document.getElementById('scheduleDay');
    const memberCheckboxContainer = document.getElementById('memberCheckboxList');
    const scheduleDisplay = document.getElementById('scheduleDisplay');
    const attendanceDateInput = document.getElementById('attendanceDate');
    const attendanceMarkingDiv = document.getElementById('attendanceMarking');
    const attendanceCheckboxesDiv = document.getElementById('attendanceCheckboxes');
    const noScheduleMessage = document.getElementById('noScheduleMessage');
    const saveAttendanceButton = document.getElementById('saveAttendanceButton');
    const attendanceStatusDiv = document.getElementById('attendanceStatus');
    const reportDisplay = document.getElementById('reportDisplay');
    const selectedDateDisplay = document.getElementById('selectedDateDisplay');
    const selectedDayDisplay = document.getElementById('selectedDayDisplay');
    const backupDataArea = document.getElementById('backupDataArea');
    const restoreDataArea = document.getElementById('restoreDataArea');

    /***********************************************************************
     *     4) LOGIN SEDERHANA (STATIS)                                     *
     ***********************************************************************/
    window.handleLogin = function() {
      const username = usernameInput.value.trim();
      const password = passwordInput.value;
      if (username === "Admin" && password === "Admin123") {
        loginError.textContent = "";
        loginScreen.style.display = "none";
        mainApp.style.display = "block";
        document.body.style.display = "block";
        document.body.style.justifyContent = "";
        document.body.style.alignItems = "";
        document.body.style.minHeight = "";
        document.body.style.padding = "20px";

        initializeAppMainApp();
      } else {
        loginError.textContent = "Username atau Password salah.";
        passwordInput.value = "";
      }
    };

    /***********************************************************************
     *     5) INITIALIZE MAIN APP                                         *
     ***********************************************************************/
    function initializeAppMainApp() {
      console.log("Loading data from Firestore...");
      loadAllData().then(() => {
        displayMembers();
        updateMemberCheckboxesForScheduling();
        displaySchedule();
        setDefaultAttendanceDate();
        addGlobalEventListeners();
        console.log("Main app ready.");
      }).catch(err => {
        console.error("Error loading data:", err);
        alert("Gagal memuat data Firestore. Lihat console!");
      });
    }

    function loadAllData() {
      return Promise.all([
        loadMembersFromFirestore(),
        loadScheduleFromFirestore(),
        loadAttendanceFromFirestore()
      ]);
    }

    /***********************************************************************
     *     6) LOAD MEMBERS (Firestore)                                     *
     ***********************************************************************/
    async function loadMembersFromFirestore() {
      members = [];
      const snap = await getDocs(collection(db, "members"));
      snap.forEach(docSnap => {
        const data = docSnap.data();
        if (data.name) members.push(data.name);
      });
      members.sort();
    }

    /***********************************************************************
     *     7) LOAD SCHEDULE (Firestore)                                    *
     ***********************************************************************/
    async function loadScheduleFromFirestore() {
      schedule = {};
      const snap = await getDocs(collection(db, "schedules"));
      snap.forEach(docSnap => {
        const data = docSnap.data();
        if (data.day && Array.isArray(data.members)) {
          schedule[data.day] = data.members;
        }
      });
    }

    /***********************************************************************
     *     8) LOAD ATTENDANCE (Firestore)                                  *
     ***********************************************************************/
    async function loadAttendanceFromFirestore() {
      attendance = {};
      const snap = await getDocs(collection(db, "attendance"));
      snap.forEach(docSnap => {
        const data = docSnap.data();
        if (data.date && data.records) {
          attendance[data.date] = migrateAttendanceObject(data.records);
        }
      });
    }
    function migrateAttendanceObject(records) {
      const result = {};
      for (const memberName in records) {
        const val = records[memberName];
        if (typeof val === "boolean") {
          result[memberName] = { present: val, reason: "" };
        } else if (val && typeof val.present === "boolean") {
          result[memberName] = {
            present: val.present,
            reason: val.reason || ""
          };
        } else {
          result[memberName] = { present: false, reason: "" };
        }
      }
      return result;
    }

    function setDefaultAttendanceDate() {
      try {
        attendanceDateInput.valueAsDate = new Date();
      } catch (e) {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, "0");
        const dd = String(today.getDate()).padStart(2, "0");
        attendanceDateInput.value = `${yyyy}-${mm}-${dd}`;
      }
    }

    function addGlobalEventListeners() {
      scheduleDaySelect.addEventListener("change", () => {
        loadScheduleForDay(scheduleDaySelect.value);
      });
      attendanceCheckboxesDiv.addEventListener("change", (event) => {
        if (
          event.target.type === "checkbox" &&
          event.target.classList.contains("attendance-checkbox")
        ) {
          const reasonInput = event.target
            .closest(".attendance-item")
            .querySelector(".reason-input");
          if (reasonInput) {
            reasonInput.style.display = event.target.checked
              ? "none"
              : "inline-block";
            if (event.target.checked) {
              reasonInput.value = "";
            }
          }
        }
      });
    }

    /***********************************************************************
     *     9) MANAGEMENT ANGGOTA                                           *
     ***********************************************************************/
    window.addMember = async function() {
      const name = newMemberNameInput.value.trim();
      if (!name) {
        showNotification("Nama anggota tidak boleh kosong", "error");
        return;
      }
      if (members.includes(name)) {
        showNotification(`Nama "${name}" sudah ada`, "error");
        return;
      }
      try {
        await addDoc(collection(db, "members"), { name });
        showNotification(`Anggota "${name}" berhasil ditambahkan.`, "success");
        await loadMembersFromFirestore();
        displayMembers();
        updateMemberCheckboxesForScheduling();
        newMemberNameInput.value = "";
      } catch (err) {
        console.error(err);
        showNotification("Gagal menambahkan anggota ke Firestore", "error");
      }
    };

    function displayMembers() {
      memberListDisplay.innerHTML = "";
      if (members.length === 0) {
        memberListDisplay.innerHTML = "<li>Belum ada anggota.</li>";
        return;
      }
      members.forEach(member => {
        const li = document.createElement("li");
        li.dataset.memberName = member;

        const nameSpan = document.createElement("span");
        nameSpan.textContent = member;
        nameSpan.classList.add("member-name");

        const viewControls = document.createElement("div");
        viewControls.classList.add("view-controls");

        const editBtn = document.createElement("button");
        editBtn.textContent = "Edit";
        editBtn.classList.add("info", "small-btn");
        editBtn.onclick = () => startEditMember(member, li);

        const removeBtn = document.createElement("button");
        removeBtn.textContent = "Hapus";
        removeBtn.classList.add("danger", "small-btn");
        removeBtn.onclick = () => removeMember(member);

        viewControls.appendChild(editBtn);
        viewControls.appendChild(removeBtn);

        const editControls = document.createElement("div");
        editControls.classList.add("edit-controls");

        const editInput = document.createElement("input");
        editInput.type = "text";
        editInput.value = member;
        editInput.classList.add("edit-member-input");

        const saveBtn = document.createElement("button");
        saveBtn.textContent = "Simpan";
        saveBtn.classList.add("success", "small-btn");
        saveBtn.onclick = () => saveEditMember(member, li);

        const cancelBtn = document.createElement("button");
        cancelBtn.textContent = "Batal";
        cancelBtn.classList.add("secondary", "small-btn");
        cancelBtn.onclick = () => cancelEditMember(li);

        editControls.appendChild(editInput);
        editControls.appendChild(saveBtn);
        editControls.appendChild(cancelBtn);

        li.appendChild(nameSpan);
        li.appendChild(viewControls);
        li.appendChild(editControls);
        memberListDisplay.appendChild(li);
      });
    }

    function startEditMember(memberName, listItemElement) {
      listItemElement.querySelector(".view-controls").style.display = "none";
      listItemElement.querySelector(".member-name").style.display = "none";
      listItemElement.querySelector(".edit-controls").style.display = "flex";
      listItemElement.querySelector(".edit-member-input").focus();
    }

    function cancelEditMember(listItemElement) {
      listItemElement.querySelector(".edit-controls").style.display = "none";
      listItemElement.querySelector(".view-controls").style.display = "flex";
      listItemElement.querySelector(".member-name").style.display = "inline";
      const originalName = listItemElement.dataset.memberName;
      listItemElement.querySelector(".edit-member-input").value = originalName;
    }

    async function saveEditMember(originalName, listItemElement) {
      const editInput = listItemElement.querySelector(".edit-member-input");
      const newName = editInput.value.trim();

      if (!newName) {
        showNotification("Nama tidak boleh kosong", "error");
        return;
      }
      if (newName !== originalName && members.includes(newName)) {
        showNotification(`Nama "${newName}" sudah digunakan anggota lain.`, "error");
        return;
      }
      if (newName === originalName) {
        cancelEditMember(listItemElement);
        return;
      }

      try {
        // Cari doc members yg name=originalName, update jadi newName
        const memSnap = await getDocs(collection(db, "members"));
        let docIdToUpdate = null;
        memSnap.forEach(docSnap => {
          if (docSnap.data().name === originalName) {
            docIdToUpdate = docSnap.id;
          }
        });
        if (!docIdToUpdate) {
          showNotification(`Anggota "${originalName}" tidak ditemukan di Firestore`, "error");
          cancelEditMember(listItemElement);
          return;
        }
        const memDocRef = doc(db, "members", docIdToUpdate);
        await updateDoc(memDocRef, { name: newName });

        // Rename di schedules & attendance
        await renameMemberInSchedules(originalName, newName);
        await renameMemberInAttendance(originalName, newName);

        showNotification(`Nama "${originalName}" diubah ke "${newName}"`, "success");

        await loadAllData();
        displayMembers();
        updateMemberCheckboxesForScheduling();
        displaySchedule();
        if (attendanceMarkingDiv.style.display === "block") {
          showAttendanceForm();
        }
      } catch (err) {
        console.error(err);
        showNotification("Gagal edit nama anggota di Firestore", "error");
      }
    }

    async function renameMemberInSchedules(oldName, newName) {
      const snap = await getDocs(collection(db, "schedules"));
      const batcher = writeBatch(db);

      snap.forEach(docSnap => {
        const data = docSnap.data();
        if (data.day && Array.isArray(data.members)) {
          let changed = false;
          const newArr = data.members.map(m => {
            if (m === oldName) {
              changed = true;
              return newName;
            }
            return m;
          });
          if (changed) {
            data.members = newArr;
            batcher.update(doc(db, "schedules", docSnap.id), data);
          }
        }
      });
      await batcher.commit();
    }

    async function renameMemberInAttendance(oldName, newName) {
      const snap = await getDocs(collection(db, "attendance"));
      const batcher = writeBatch(db);

      snap.forEach(docSnap => {
        const data = docSnap.data();
        if (data.records && data.records[oldName]) {
          data.records[newName] = data.records[oldName];
          delete data.records[oldName];
          batcher.update(doc(db, "attendance", docSnap.id), data);
        }
      });
      await batcher.commit();
    }

    async function removeMember(nameToRemove) {
      if (!confirm(`Yakin ingin menghapus anggota "${nameToRemove}"?`)) return;
      try {
        // 1. Hapus doc di "members"
        const memSnap = await getDocs(collection(db, "members"));
        let docIdToDelete = null;
        memSnap.forEach(docSnap => {
          if (docSnap.data().name === nameToRemove) {
            docIdToDelete = docSnap.id;
          }
        });
        if (docIdToDelete) {
          await deleteDoc(doc(db, "members", docIdToDelete));
        }

        // 2. Hapus dari schedules
        const schedSnap = await getDocs(collection(db, "schedules"));
        const batcher = writeBatch(db);
        schedSnap.forEach(docSnap => {
          const data = docSnap.data();
          if (data.day && Array.isArray(data.members)) {
            const filtered = data.members.filter(m => m !== nameToRemove);
            if (filtered.length !== data.members.length) {
              data.members = filtered;
              batcher.update(doc(db, "schedules", docSnap.id), data);
            }
          }
        });

        // 3. Hapus dari attendance
        const attSnap = await getDocs(collection(db, "attendance"));
        attSnap.forEach(docSnap => {
          const data = docSnap.data();
          if (data.records && data.records[nameToRemove]) {
            delete data.records[nameToRemove];
            batcher.update(doc(db, "attendance", docSnap.id), data);
          }
        });

        await batcher.commit();

        showNotification(`Anggota "${nameToRemove}" berhasil dihapus.`, "success");
        await loadAllData();
        displayMembers();
        updateMemberCheckboxesForScheduling();
        displaySchedule();
        attendanceMarkingDiv.style.display = "none";
        attendanceStatusDiv.innerHTML = "";
        reportDisplay.innerHTML = "";
      } catch (err) {
        console.error(err);
        showNotification("Gagal menghapus anggota di Firestore", "error");
      }
    }

    /***********************************************************************
     *     10) MANAGEMENT JADWAL                                           *
     ***********************************************************************/
    function updateMemberCheckboxesForScheduling() {
      memberCheckboxContainer.innerHTML = "";
      if (members.length === 0) {
        memberCheckboxContainer.innerHTML = "<p>Tambahkan anggota terlebih dahulu.</p>";
        return;
      }
      members.forEach(member => {
        const labelEl = document.createElement("label");
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.value = member;
        const safeMemberId = member.replace(/[^a-zA-Z0-9-_]/g, "");
        cb.id = `schedule-cb-${safeMemberId}`;
        labelEl.appendChild(cb);
        labelEl.appendChild(document.createTextNode(" " + member));
        labelEl.htmlFor = cb.id;
        memberCheckboxContainer.appendChild(labelEl);
      });
      loadScheduleForDay(scheduleDaySelect.value);
    }

    function loadScheduleForDay(day) {
      const scheduledMembers = schedule[day] || [];
      const cbs = memberCheckboxContainer.querySelectorAll("input[type='checkbox']");
      cbs.forEach(cb => {
        cb.checked = scheduledMembers.includes(cb.value);
      });
    }

    window.saveScheduleForDay = async function() {
      const day = scheduleDaySelect.value;
      const cbs = memberCheckboxContainer.querySelectorAll("input[type='checkbox']:checked");
      const dayMembers = Array.from(cbs).map(cb => cb.value);

      try {
        await setDoc(doc(db, "schedules", day), {
          day,
          members: dayMembers
        });
        schedule[day] = dayMembers;
        displaySchedule();
        showNotification(`Jadwal untuk hari ${day} disimpan.`, "success");
      } catch (err) {
        console.error(err);
        showNotification("Gagal menyimpan jadwal ke Firestore", "error");
      }
    };

    window.clearScheduleForDay = async function() {
      const day = scheduleDaySelect.value;
      if (!confirm(`Yakin ingin mengosongkan jadwal piket untuk hari ${day}?`)) return;
      try {
        await setDoc(doc(db, "schedules", day), { day, members: [] });
        schedule[day] = [];
        displaySchedule();
        loadScheduleForDay(day);
        showNotification(`Jadwal untuk hari ${day} dikosongkan.`, "success");
      } catch (err) {
        console.error(err);
        showNotification("Gagal mengosongkan jadwal di Firestore", "error");
      }
    };

    function displaySchedule() {
      scheduleDisplay.innerHTML = "";
      const daysOrder = ["Senin","Selasa","Rabu","Kamis","Jumat","Sabtu","Minggu"];
      let hasSchedule = false;
      daysOrder.forEach(day => {
        if (schedule[day] && schedule[day].length > 0) {
          hasSchedule = true;
          const div = document.createElement("div");
          const names = schedule[day].join(", ") || "<i>(Kosong)</i>";
          div.innerHTML = `<strong>${day}:</strong> ${names}`;
          scheduleDisplay.appendChild(div);
        }
      });
      if (!hasSchedule) {
        scheduleDisplay.innerHTML = "<div>Belum ada jadwal yang diatur.</div>";
      }
    }

    /***********************************************************************
     *     11) ABSENSI / KEHADIRAN                                         *
     ***********************************************************************/
    window.showAttendanceForm = function() {
      const selectedDate = attendanceDateInput.value;
      if (!selectedDate || !/^\d{4}-\d{2}-\d{2}$/.test(selectedDate)) {
        showNotification("Silakan pilih tanggal valid (YYYY-MM-DD).", "error");
        return;
      }
      const dateObj = new Date(selectedDate + "T00:00:00");
      if (isNaN(dateObj.getTime())) {
        showNotification("Tanggal tidak valid.", "error");
        return;
      }
      const dayIndex = dateObj.getDay();
      const dayName = daysInIndonesian[dayIndex];

      selectedDateDisplay.textContent = selectedDate;
      selectedDayDisplay.textContent = dayName;
      attendanceMarkingDiv.style.display = "block";
      attendanceCheckboxesDiv.innerHTML = "";
      attendanceStatusDiv.innerHTML = "";
      saveAttendanceButton.style.display = "none";
      noScheduleMessage.style.display = "none";

      const scheduled = schedule[dayName] || [];
      const validScheduledMembers = scheduled.filter(m => members.includes(m));

      if (validScheduledMembers.length === 0) {
        noScheduleMessage.style.display = "block";
        attendanceCheckboxesDiv.innerHTML =
          "<p>Tidak ada anggota yang dijadwalkan piket pada hari ini.</p>";
      } else {
        saveAttendanceButton.style.display = "inline-block";
        const existingAttendance = attendance[selectedDate] || {};

        validScheduledMembers.forEach(member => {
          const record = existingAttendance[member] || { present: false, reason: "" };
          const isPresent = record.present;
          const currentReason = record.reason || "";

          const itemDiv = document.createElement("div");
          itemDiv.classList.add("attendance-item");

          const labelEl = document.createElement("label");
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.value = member;
          checkbox.checked = isPresent;
          checkbox.classList.add("attendance-checkbox");
          const safeMemberId = member.replace(/[^a-zA-Z0-9-_]/g, "");
          checkbox.id = `att-${selectedDate}-${safeMemberId}`;

          labelEl.htmlFor = checkbox.id;
          labelEl.appendChild(checkbox);
          labelEl.appendChild(document.createTextNode(" " + member));

          const reasonInput = document.createElement("input");
          reasonInput.type = "text";
          reasonInput.value = currentReason;
          reasonInput.placeholder = "Alasan (jika tidak hadir)...";
          reasonInput.classList.add("reason-input");
          reasonInput.style.display = isPresent ? "none" : "inline-block";

          itemDiv.appendChild(labelEl);
          itemDiv.appendChild(reasonInput);
          attendanceCheckboxesDiv.appendChild(itemDiv);
        });

        displayAttendanceStatus(selectedDate, dayName);
      }
    };

    window.saveAttendance = async function() {
      const selectedDate = attendanceDateInput.value;
      if (!selectedDate || !/^\d{4}-\d{2}-\d{2}$/.test(selectedDate)) {
        showNotification("Tanggal tidak valid.", "error");
        return;
      }
      const dateObj = new Date(selectedDate + "T00:00:00");
      if (isNaN(dateObj.getTime())) {
        showNotification("Tanggal tidak valid.", "error");
        return;
      }
      const dayName = daysInIndonesian[dateObj.getDay()];
      const scheduled = schedule[dayName] || [];

      const newRecords = {};
      const items = attendanceCheckboxesDiv.querySelectorAll(".attendance-item");
      items.forEach(item => {
        const checkbox = item.querySelector(".attendance-checkbox");
        const reasonInput = item.querySelector(".reason-input");
        const memberName = checkbox.value;
        if (scheduled.includes(memberName)) {
          const isPresent = checkbox.checked;
          const reason = isPresent ? "" : reasonInput.value.trim();
          newRecords[memberName] = { present: isPresent, reason };
        }
      });

      try {
        const docRef = doc(db, "attendance", selectedDate);
        if (Object.keys(newRecords).length === 0) {
          await deleteDoc(docRef);
          delete attendance[selectedDate];
          showNotification(
            `Data absensi ${selectedDate} dihapus karena kosong.`,
            "info"
          );
        } else {
          await setDoc(docRef, {
            date: selectedDate,
            records: newRecords
          });
          attendance[selectedDate] = newRecords;
          showNotification(`Kehadiran ${selectedDate} disimpan.`, "success");
        }
        displayAttendanceStatus(selectedDate, dayName);
      } catch (err) {
        console.error(err);
        showNotification("Gagal menyimpan kehadiran di Firestore", "error");
      }
    };

    function displayAttendanceStatus(selectedDate, dayName) {
      attendanceStatusDiv.innerHTML = "";
      const scheduled = schedule[dayName] || [];
      const validScheduled = scheduled.filter(m => members.includes(m));
      const attData = attendance[selectedDate] || {};

      if (validScheduled.length === 0) {
        attendanceStatusDiv.innerHTML = "<p>Tidak ada jadwal piket.</p>";
        return;
      }
      attendanceStatusDiv.innerHTML = `<strong>Status Kehadiran ${selectedDate} (${dayName}):</strong>`;
      const presentUl = document.createElement("ul");
      const absentUl = document.createElement("ul");
      let presentCount = 0;
      let absentCount = 0;

      validScheduled.forEach(member => {
        const li = document.createElement("li");
        const record = attData[member] || { present: false, reason: "" };
        li.textContent = member;
        if (record.present) {
          li.classList.add("present");
          li.textContent += " (Piket)";
          presentUl.appendChild(li);
          presentCount++;
        } else {
          li.classList.add("absent");
          li.textContent += " (Tidak Piket)";
          if (record.reason) {
            const reasonSpan = document.createElement("span");
            reasonSpan.classList.add("reason-text");
            reasonSpan.textContent = `- ${record.reason}`;
            li.appendChild(reasonSpan);
          }
          absentUl.appendChild(li);
          absentCount++;
        }
      });

      const summary = document.createElement("p");
      summary.innerHTML = `Total Piket: <span class="present">${presentCount}</span>, 
                           Total Tidak Piket: <span class="absent">${absentCount}</span>`;
      attendanceStatusDiv.appendChild(summary);

      if (presentUl.hasChildNodes()) {
        const presentHeader = document.createElement("strong");
        presentHeader.textContent = "Daftar Hadir (Piket):";
        presentHeader.style.color = "var(--success-green)";
        attendanceStatusDiv.appendChild(presentHeader);
        attendanceStatusDiv.appendChild(presentUl);
      }
      if (absentUl.hasChildNodes()) {
        const absentHeader = document.createElement("strong");
        absentHeader.textContent = "Daftar Tidak Hadir (Tidak Piket):";
        absentHeader.style.color = "var(--danger-red)";
        absentHeader.style.display = "block";
        absentHeader.style.marginTop = "10px";
        attendanceStatusDiv.appendChild(absentHeader);
        attendanceStatusDiv.appendChild(absentUl);
      }
    }

    /***********************************************************************
     *     12) LAPORAN KERAJINAN                                          *
     ***********************************************************************/
    window.generateReport = function() {
      reportDisplay.innerHTML = "";
      if (members.length === 0) {
        reportDisplay.innerHTML = "<p>Tidak ada anggota OSIS untuk dilaporkan.</p>";
        return;
      }
      const hasSchedule = Object.keys(schedule).some(day => schedule[day]?.length);
      const hasAttendance = Object.keys(attendance).length > 0;
      if (!hasSchedule && !hasAttendance) {
        reportDisplay.innerHTML = "<p>Belum ada data jadwal atau kehadiran.</p>";
        return;
      }
      const memberStats = {};
      members.forEach(m => (memberStats[m] = { scheduled: 0, attended: 0 }));
      let totalRecords = 0;

      for (const date in attendance) {
        const dateObj = new Date(date + "T00:00:00");
        if (isNaN(dateObj.getTime())) continue;
        const dayName = daysInIndonesian[dateObj.getDay()];
        const schedMembers = schedule[dayName] || [];
        const dailyRecord = attendance[date] || {};
        schedMembers.forEach(member => {
          if (dailyRecord[member] !== undefined) {
            memberStats[member].scheduled++;
            totalRecords++;
            if (dailyRecord[member].present) {
              memberStats[member].attended++;
            }
          }
        });
      }
      if (totalRecords === 0) {
        reportDisplay.innerHTML = "<p>Belum ada data kehadiran relevan.</p>";
        return;
      }
      const dataArr = members.map(m => {
        const s = memberStats[m];
        const pct = s.scheduled ? (s.attended / s.scheduled) * 100 : 0;
        return { name: m, attended: s.attended, scheduled: s.scheduled, percentage: pct };
      });
      dataArr.sort((a,b) => b.percentage - a.percentage || b.attended - a.attended || a.name.localeCompare(b.name));

      displayReportSummary(dataArr);
      dataArr.forEach(item => {
        const div = document.createElement("div");
        div.classList.add("report-item");

        const nameSpan = document.createElement("span");
        nameSpan.textContent = item.name + ": ";
        nameSpan.style.fontWeight = "bold";

        const statsSpan = document.createElement("span");
        statsSpan.innerHTML = `Hadir <strong>${item.attended}</strong> dari <strong>${item.scheduled}</strong> kali piket.`;

        div.appendChild(nameSpan);
        div.appendChild(statsSpan);

        if (item.scheduled > 0) {
          const barContainer = document.createElement("div");
          barContainer.classList.add("report-bar-container");

          const bar = document.createElement("div");
          bar.classList.add("report-bar");
          bar.style.width = item.percentage + "%";
          if (item.percentage < 50) bar.classList.add("low");

          const pctSpan = document.createElement("span");
          pctSpan.classList.add("report-text");
          pctSpan.textContent = `(${item.percentage.toFixed(1)}%)`;

          barContainer.appendChild(bar);
          barContainer.appendChild(pctSpan);
          div.appendChild(barContainer);
        } else {
          const noData = document.createElement("span");
          noData.classList.add("report-text");
          noData.style.marginLeft = "10px";
          noData.textContent = "(Tidak ada data piket)";
          div.appendChild(noData);
        }
        reportDisplay.appendChild(div);
      });
    };

    function displayReportSummary(dataArr) {
      const filtered = dataArr.filter(m => m.scheduled > 0);
      if (!filtered.length) return;
      const summaryDiv = document.createElement("div");
      summaryDiv.classList.add("report-summary");

      const most = filtered[0];
      const least = filtered[filtered.length - 1];

      let html = `👏 <strong>Paling Rajin:</strong> ${most.name} (${most.percentage.toFixed(1)}%)<br>`;
      if (filtered.length > 1 && most.name !== least.name) {
        html += `🤔 <strong>Kurang Rajin:</strong> ${least.name} (${least.percentage.toFixed(1)}%)`;
      } else if (filtered.length === 1) {
        html += `🤔 <strong>Kurang Rajin:</strong> (Hanya satu anggota dengan data)`;
      } else {
        html += `🤔 <strong>Kurang Rajin:</strong> (Data sama)`;
      }
      summaryDiv.innerHTML = html;
      reportDisplay.appendChild(summaryDiv);
    }

    window.exportReportToCSV = function() {
      const reportItems = reportDisplay.querySelectorAll(".report-item");
      if (!reportItems.length) {
        showNotification("Buat laporan dulu sebelum ekspor.", "warning");
        return;
      }
      let csv = "data:text/csv;charset=utf-8,";
      csv += "Nama Anggota,Jadwal Tercatat,Hadir,Persentase Kehadiran (%)\r\n";

      // Hitung ulang stats
      const stats = {};
      members.forEach(m => stats[m] = { scheduled:0, attended:0 });

      for (const date in attendance) {
        const dateObj = new Date(date + "T00:00:00");
        if (isNaN(dateObj.getTime())) continue;
        const dayName = daysInIndonesian[dateObj.getDay()];
        const daily = attendance[date] || {};
        const schedMem = schedule[dayName] || [];
        schedMem.forEach(mem => {
          if (daily[mem] !== undefined) {
            stats[mem].scheduled++;
            if (daily[mem].present) {
              stats[mem].attended++;
            }
          }
        });
      }
      const dataArr = members.map(m => {
        const s = stats[m];
        const pct = s.scheduled ? (s.attended / s.scheduled) * 100 : 0;
        return { name:m, scheduled:s.scheduled, attended:s.attended, percentage:pct };
      });
      dataArr.sort((a,b)=>b.percentage-a.percentage || b.attended-a.attended || a.name.localeCompare(b.name));

      dataArr.forEach(row => {
        const safeName = `"${row.name.replace(/"/g, '""')}"`;
        csv += [
          safeName,
          row.scheduled,
          row.attended,
          row.percentage.toFixed(1)
        ].join(",") + "\r\n";
      });

      const encoded = encodeURI(csv);
      const link = document.createElement("a");
      link.setAttribute("href", encoded);
      const today = new Date().toISOString().slice(0,10);
      link.setAttribute("download", `laporan_piket_osis_${today}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      showNotification("Laporan CSV diunduh.", "success");
    };

    /***********************************************************************
     *     13) BACKUP & RESTORE                                            *
     ***********************************************************************/
    window.backupData = function() {
      try {
        const dataToBackup = {
          members,
          schedule,
          attendance,
          backupDate: new Date().toISOString()
        };
        const json = JSON.stringify(dataToBackup, null, 2);
        backupDataArea.value = json;
        backupDataArea.select();
        showNotification("Data backup berhasil dibuat. Silakan salin!", "success");
      } catch (err) {
        console.error(err);
        showNotification("Gagal membuat backup data (memori).", "error");
      }
    };

    window.restoreData = async function() {
      const backupJSON = restoreDataArea.value.trim();
      if (!backupJSON) {
        showNotification("Belum ada data backup di area restore.", "warning");
        return;
      }
      if (!confirm("PERHATIAN!\nData Firestore akan ditimpa dengan backup.\nLanjutkan?")) {
        return;
      }
      try {
        const restored = JSON.parse(backupJSON);
        if (!Array.isArray(restored.members) || !restored.schedule || !restored.attendance) {
          throw new Error("Format data backup tidak valid (kurang field).");
        }
        await resetAllData(false);

        // Tulis members
        for (const m of restored.members) {
          await addDoc(collection(db, "members"), { name: m });
        }
        // Tulis schedule
        for (const day in restored.schedule) {
          const arr = restored.schedule[day];
          if (Array.isArray(arr)) {
            await setDoc(doc(db, "schedules", day), { day, members: arr });
          }
        }
        // Tulis attendance
        for (const date in restored.attendance) {
          const recs = restored.attendance[date];
          await setDoc(doc(db, "attendance", date), {
            date,
            records: recs
          });
        }

        await loadAllData();
        displayMembers();
        updateMemberCheckboxesForScheduling();
        displaySchedule();
        attendanceMarkingDiv.style.display = "none";
        attendanceStatusDiv.innerHTML = "";
        reportDisplay.innerHTML = "";
        restoreDataArea.value = "";

        showNotification("Restore data ke Firestore berhasil!", "success");
      } catch (err) {
        console.error(err);
        showNotification(`Gagal restore data: ${err.message}`, "error");
      }
    };

    window.resetAllData = async function(askConfirm = true) {
      if (askConfirm) {
        if (!confirm("PERINGATAN!\nSemua data Firestore (anggota, jadwal, kehadiran) akan dihapus.")) {
          return;
        }
      }
      try {
        // 1. Hapus members
        let snap = await getDocs(collection(db, "members"));
        let batcher = writeBatch(db);
        snap.forEach(docSnap => {
          batcher.delete(docSnap.ref);
        });

        // 2. Hapus schedules
        snap = await getDocs(collection(db, "schedules"));
        snap.forEach(docSnap => {
          batcher.delete(docSnap.ref);
        });

        // 3. Hapus attendance
        snap = await getDocs(collection(db, "attendance"));
        snap.forEach(docSnap => {
          batcher.delete(docSnap.ref);
        });
        await batcher.commit();

        // Kosongkan local
        members = [];
        schedule = {};
        attendance = {};

        displayMembers();
        updateMemberCheckboxesForScheduling();
        displaySchedule();
        attendanceMarkingDiv.style.display = "none";
        attendanceStatusDiv.innerHTML = "";
        reportDisplay.innerHTML = "";
        backupDataArea.value = "";
        restoreDataArea.value = "";

        showNotification("Semua data di Firestore sudah direset.", "success");
      } catch (err) {
        console.error(err);
        showNotification("Gagal reset data di Firestore", "error");
      }
    };

    /***********************************************************************
     *     14) NOTIFICATION UTILITY                                        *
     ***********************************************************************/
    function showNotification(message, type="info") {
      console.log(`[${type.toUpperCase()}] ${message}`);
      if (type === "error") {
        alert("Error: " + message);
      } else if (type === "warning") {
        alert("Peringatan: " + message);
      } else {
        alert(message);
      }
    }

    /***********************************************************************
     *     15) INIT: TAMPILKAN LAYAR LOGIN                                 *
     ***********************************************************************/
    mainApp.style.display = "none";
    loginScreen.style.display = "block";
  </script>

</body>
</html>
